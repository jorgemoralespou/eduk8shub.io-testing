<script type="text/javascript">
    var lunrIndex,
        $results,
        pagesIndex;
  
    // Initialize lunrjs using our generated index file
    function initLunr() {
        // First retrieve the index file
        $.getJSON("/js/lunr/PagesIndex.json")
            .done(function(index) {
                pagesIndex = index;
//                console.log("index:", pagesIndex);
  
                lunrIndex = lunr(function () {
                  this.field("title", {
                    boost: 20
                  });
                  this.field("tags", {
                    boost: 10
                  });
                  this.field("categories", {
                    boost: 10
                  });
                  this.field("content",{
                    boost: 5
                  });
  
                  // ref is the result item identifier (I chose the page id)
                  this.ref("id");
  
                  pagesIndex.forEach(function (doc) {
                    this.add(doc)
                  }, this)
                });
            })
            .fail(function(jqxhr, textStatus, error) {
                var err = textStatus + ", " + error;
                console.error("Error getting Hugo index flie:", err);
            });
    }
  
    // Nothing crazy here, just hook up a listener on the input field
    function initUI() {
        $("#clear_search").hide();
        $("#clear_search").click(function(){
          $("#search").val("");
          doSearch("");
        });
        $("#search").keyup(function() {
            // Only trigger a search when 2 chars. at least have been provided
            var query = $(this).val();
            doSearch(query);
        });
    }

    function doSearch(searchString){
      var results = search(searchString);
      // Show the results that have been returned, hide all others
      renderResults(results, searchString);
    }
  
    function search(query) {
        return lunrIndex.search(query).map(function(result) {
                return pagesIndex.filter(function(page) {
                    return page.id === result.ref;
                })[0];
            });
    }
  
    function renderResults(results, query) {
        if (query.length==0){
            visibleAll(true);
            $("#clear_search").hide();
        }else{
          $("#clear_search").show();
        }
        if (!results.length) {
            visibleAll(false);
        }

//        results.forEach(function(item){console.log(item.id)});
        $(".index-anchor" ).each(function(idx, element){
          var toshow = false;  
          results.forEach(function(result){
            if (result.id === element.id){
              toshow = true;
            }
          });
          if (toshow){
            $(element).show();
          }else{
            $(element).hide();
          }
        });
    }

    function visibleAll(show) {
        $(".index-anchor").each(function (idx, element) {
            if (show) {
                $(element).show();
            } else {
                $(element).hide();
            }
        });
        return;
    }
  
    // Let's get started
    initLunr();
  
    $(document).ready(function() {
        initUI();
    });
</script>

      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <div class="search-group">
              <span class="fa fa-search search-icon" aria-hidden="true"></span>
              <input type="text" class="form-control" id="search" placeholder="Search">
              <a href="#" id="clear_search" class="fa fa-times-circle clear-icon"></a>
          </div>
        </div>
      </form>